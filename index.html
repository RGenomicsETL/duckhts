<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DuckDB High Throughput Sequencing File Formats Reader Extension for R • Rduckhts</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="DuckDB High Throughput Sequencing File Formats Reader Extension for R">
<meta name="description" content="Bundles the duckhts DuckDB extension for reading High Throughput Sequencing file formats from R via DuckDB. The DuckDB C extension API &lt;https://duckdb.org/docs/stable/clients/c/api&gt; and its htslib dependency are compiled from vendored sources during package installation. James K Bonfield et al. (2021) &lt;doi:10.1093/gigascience/giab007&gt;.">
<meta property="og:description" content="Bundles the duckhts DuckDB extension for reading High Throughput Sequencing file formats from R via DuckDB. The DuckDB C extension API &lt;https://duckdb.org/docs/stable/clients/c/api&gt; and its htslib dependency are compiled from vendored sources during package installation. James K Bonfield et al. (2021) &lt;doi:10.1093/gigascience/giab007&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">Rduckhts</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2-0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RGenomicsETL/duckhts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rduckhts-duckdb-hts-file-reader-extension-for-r">Rduckhts: DuckDB HTS File Reader Extension for R<a class="anchor" aria-label="anchor" href="#rduckhts-duckdb-hts-file-reader-extension-for-r"></a>
</h1></div>
<p><a href="https://cran.r-project.org/package=Rduckhts" class="external-link"><img src="https://www.r-pkg.org/badges/version/Rduckhts" alt="CRAN Status"></a><a href="https://RGenomicsETL.r-universe.dev/Rduckhts" class="external-link"><img src="https://RGenomicsETL.r-universe.dev/Rduckhts/badges/version" alt="R-universe version"></a></p>
<p><code>Rduckhts</code> provides an R interface to a <a href="https://duckdb.org/" class="external-link">DuckDB</a> <code>HTS</code> (High Throughput Sequencing) file reader extension. This enables reading common bioinformatics file formats such as <code>VCF</code>/<code>BCF</code>, <code>SAM</code>/<code>BAM</code>/<code>CRAM</code>, <code>FASTA</code>, <code>FASTQ</code>, <code>GFF</code>, <code>GTF</code>, and tabix-indexed files directly from <code>R</code> using <code>SQL</code> queries via <a href="https://github.com/RGenomicsETL/duckhts" class="external-link"><code>duckhts</code></a>.</p>
<div class="section level2">
<h2 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h2>
<p>Following <a href="https://github.com/RGenomicsETL/RBCFTools" class="external-link">RBCFTools</a>, tables are created and returned instead of data frames. <code>VCF</code>/<code>BCF</code>, <code>SAM</code>/<code>BAM</code>/<code>CRAM</code>, <code>FASTA</code>, <code>FASTQ</code>, <code>GFF</code>, <code>GTF</code>, and <code>tabix</code> formats can be queried. We support region queries for indexed files, and we target Linux, macOS, and RTools. <a href="https://github.com/samtools/htslib" class="external-link"><code>htslib</code></a> 1.23 is bundled so build dependencies stay minimal. The extensnion is built by adapting the generic extension infracstructure by using only makefiles unlike the submitted communtity extension <a href="https://github.com/RGenomicsETL/duckhts" class="external-link"><code>duckhts</code></a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package can be installed from r-universe</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install 'Rduckhts' in R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'Rduckhts'</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://rgenomicsetl.r-universe.dev'</span>, <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># When on CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Rduckhts"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="system-requirements">System Requirements<a class="anchor" aria-label="anchor" href="#system-requirements"></a>
</h2>
<p>Installation requires <code>htslib</code> dependencies such ad zlib and libbz2, and optionally for full functionally liblzma, libcurl, and openssl. The package requires GNU make. On Windows’s Rtools, <code>htslib</code> plugins are not enabled.</p>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>The extension is loaded with <code>rduckhts_load(con, extension_path = NULL)</code>. We can create tables with <code>rduckhts_bcf</code>, <code>rduckhts_bam</code>, <code>rduckhts_fasta</code>, <code>rduckhts_fastq</code>, <code>rduckhts_gff</code>, <code>rduckhts_gtf</code>, and <code>rduckhts_tabix</code> using the parameters documented in their help pages</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGenomicsETL/duckhts" class="external-link">Rduckhts</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">fasta_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ce.fa"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">fastq_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"r1.fq"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">fastq_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"r2.fq"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span>config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>allow_unsigned_extensions <span class="op">=</span> <span class="st">"true"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_load.html">rduckhts_load</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="reference/rduckhts_fasta.html">rduckhts_fasta</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"sequences"</span>, <span class="va">fasta_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_fastq.html">rduckhts_fastq</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"reads"</span>, <span class="va">fastq_r1</span>, mate_path <span class="op">=</span> <span class="va">fastq_r2</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) AS n FROM sequences"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n</span></span>
<span><span class="co">#&gt; 1 7</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) AS n FROM reads"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n</span></span>
<span><span class="co">#&gt; 1 10</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="region-queries">Region Queries<a class="anchor" aria-label="anchor" href="#region-queries"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bcf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"vcf_file.bcf"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_bcf.html">rduckhts_bcf</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"variants"</span>, <span class="va">bcf_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">variants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM variants LIMIT 5"</span><span class="op">)</span></span>
<span><span class="va">variants</span></span>
<span><span class="co">#&gt;   CHROM     POS    ID  REF  ALT  QUAL FILTER INFO_TEST INFO_DP4 INFO_AC INFO_AN</span></span>
<span><span class="co">#&gt; 1     1 3000150  &lt;NA&gt;    C    T  59.2   PASS        NA       NA       2       4</span></span>
<span><span class="co">#&gt; 2     1 3000151  &lt;NA&gt;    C    T  59.2   PASS        NA       NA       2       4</span></span>
<span><span class="co">#&gt; 3     1 3062915  id3D GTTT    G  12.9    q10        NA        1       2       4</span></span>
<span><span class="co">#&gt; 4     1 3062915 idSNP    G T, C  12.6   test         5        1    1, 1       3</span></span>
<span><span class="co">#&gt; 5     1 3106154  &lt;NA&gt; CAAA    C 342.0   PASS        NA       NA       2       4</span></span>
<span><span class="co">#&gt;   INFO_INDEL INFO_STR FORMAT_TT_A FORMAT_GT_A FORMAT_GQ_A FORMAT_DP_A</span></span>
<span><span class="co">#&gt; 1      FALSE     &lt;NA&gt;        NULL         0/1         245          NA</span></span>
<span><span class="co">#&gt; 2      FALSE     &lt;NA&gt;        NULL         0/1         245          32</span></span>
<span><span class="co">#&gt; 3       TRUE     test        NULL         0/1         409          35</span></span>
<span><span class="co">#&gt; 4      FALSE     &lt;NA&gt;        0, 1         0/1         409          35</span></span>
<span><span class="co">#&gt; 5      FALSE     &lt;NA&gt;        NULL         0/1         245          32</span></span>
<span><span class="co">#&gt;                  FORMAT_GL_A FORMAT_TT_B FORMAT_GT_B FORMAT_GQ_B FORMAT_DP_B</span></span>
<span><span class="co">#&gt; 1                       NULL        NULL         0/1         245          NA</span></span>
<span><span class="co">#&gt; 2                       NULL        NULL         0/1         245          32</span></span>
<span><span class="co">#&gt; 3               -20, -5, -20        NULL         0/1         409          35</span></span>
<span><span class="co">#&gt; 4 -20, -5, -20, -20, -5, -20        0, 1          2|         409          35</span></span>
<span><span class="co">#&gt; 5                       NULL        NULL         0/1         245          32</span></span>
<span><span class="co">#&gt;    FORMAT_GL_B</span></span>
<span><span class="co">#&gt; 1         NULL</span></span>
<span><span class="co">#&gt; 2         NULL</span></span>
<span><span class="co">#&gt; 3 -20, -5, -20</span></span>
<span><span class="co">#&gt; 4 -20, -5, -20</span></span>
<span><span class="co">#&gt; 5         NULL</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remote-vcf-on-s3">Remote VCF on S3<a class="anchor" aria-label="anchor" href="#remote-vcf-on-s3"></a>
</h3>
<p>S3 files can be query when <code>htslib</code> is built with plugins enable. This is not the case on RTools</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not run on CRAN because it requires network access.</span></span>
<span><span class="co"># Enable htslib plugins for remote access (S3/GCS/HTTP)</span></span>
<span><span class="fu"><a href="reference/setup_hts_env.html">setup_hts_env</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example S3 URL (1000 Genomes cohort VCF)</span></span>
<span><span class="va">s3_base</span> <span class="op">&lt;-</span> <span class="st">"s3://1000genomes-dragen-v3.7.6/data/cohorts/"</span></span>
<span><span class="va">s3_path</span> <span class="op">&lt;-</span> <span class="st">"gvcf-genotyper-dragen-3.7.6/hg19/3202-samples-cohort/"</span></span>
<span><span class="va">s3_vcf_file</span> <span class="op">&lt;-</span> <span class="st">"3202_samples_cohort_gg_chr22.vcf.gz"</span></span>
<span><span class="va">s3_vcf_uri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">s3_base</span>, <span class="va">s3_path</span>, <span class="va">s3_vcf_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Query remote VCF directly with DuckDB + DuckHTS (region-scoped)</span></span>
<span><span class="fu"><a href="reference/rduckhts_bcf.html">rduckhts_bcf</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"s3_variants"</span>, <span class="va">s3_vcf_uri</span>, region <span class="op">=</span> <span class="st">"chr22:16050000-16050500"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT CHROM, COUNT(*) AS n FROM s3_variants GROUP BY CHROM"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fastq-files">FASTQ files<a class="anchor" aria-label="anchor" href="#fastq-files"></a>
</h3>
<p>Three modes for fastq files, single, paired and interleaved</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"r1.fq"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"r2.fq"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">interleaved</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"interleaved.fq"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_fastq.html">rduckhts_fastq</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"paired_reads"</span>, <span class="va">r1</span>, mate_path <span class="op">=</span> <span class="va">r2</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_fastq.html">rduckhts_fastq</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"interleaved_reads"</span>, <span class="va">interleaved</span>, interleaved <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM paired_reads WHERE MATE = 1 LIMIT 5"</span><span class="op">)</span></span>
<span><span class="va">pairs</span></span>
<span><span class="co">#&gt;                              NAME DESCRIPTION</span></span>
<span><span class="co">#&gt; 1 HS25_09827:2:1201:1505:59795#49        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 HS25_09827:2:1201:1559:70726#49        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 HS25_09827:2:1201:1564:39627#49        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 HS25_09827:2:1201:1565:91731#49        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 HS25_09827:2:1201:1624:69925#49        &lt;NA&gt;</span></span>
<span><span class="co">#&gt;                                                                                               SEQUENCE</span></span>
<span><span class="co">#&gt; 1 CCGTTAGAGCATTTGTTGAAAATGCTTTCCTTGCTCCATGTGATGACTCTGGTGCCCTTGTCAAAAGCCAGCTGGGCCTATTCGTGTGGGTCTGTTTCTG</span></span>
<span><span class="co">#&gt; 2 TTGTTAAAATGACCATACCCAAAGTGATCTACAGACTCAATACAATTTCTATTGAAATACCAATCACACTCTTCACAGAACTAGAAAAACAGTTCTAAAA</span></span>
<span><span class="co">#&gt; 3 ACGCGGCAATCCAATGTGTGAGTTGAGAAGCGGTGAGGAGGGAATCCTAATTTTATGAGCAGGTCAGGACCGTGGGAGATACCTGACACCTGAGATGGTA</span></span>
<span><span class="co">#&gt; 4 GACATGCCATAACATTCATGTTTTATGTGTACAAGTCAATGAATTTTAGTATATTTACAGAGTTGTATGACTGTCTCCACAATCTAATTTTAGGTTTCCA</span></span>
<span><span class="co">#&gt; 5 GCCAGCCTCCTTCTCAATGGTCTTTTTAAACATTATATGAAAACCAGACATTTACATTTGATTTCTTTTTCAATACTATACAGTTCTAAGAGAAAAAACA</span></span>
<span><span class="co">#&gt;                                                                                                QUALITY</span></span>
<span><span class="co">#&gt; 1 CABCFGDEEFFEFHGHGGFFGDIGIJFIFHHGHEIFGHBCGHDIFBE9GIAICGGICFIBFGGHGDGGGHE?GIGDFGGHEGIEJG&gt;;FG&lt;GGHACEFGH</span></span>
<span><span class="co">#&gt; 2 CABEFGFFGFHGGGGJGGFFGKIHHJFIEHHHGIEGGEHJGHDHFGHIGICIJEFIFGIF8GGHKFHGGFEI6GGGFIGHGGIE&gt;EFCFHGGGHEJEAJE</span></span>
<span><span class="co">#&gt; 3 BACCFGBFGFHGGJGHGGFEGHIGIJHFEH:HHEHGHHBGGH9IAGHGFHIFJFFAFGIFDIGHKEIG&lt;C&gt;F,CGD66?7EFI5EEG&gt;EGGGGD5=HH6E</span></span>
<span><span class="co">#&gt; 4 CABFFGFFJFHEGEGJGGDG?FIGHHHBGHHHGIIGHGHGGHDGHFHIDFCIKEGIFHGGII9HFFGGGEEIGGEEHGGEEGDEHFH&gt;FGGGGHAFAHGE</span></span>
<span><span class="co">#&gt; 5 CABEFGFGIFGGGJGHGGFH?FDHGHDHGHEHHJCGHHFHDHDHFGHIGHIFFHGHFGGGI9GHF@IGGH;FICGEFEIHGGIEEFC:DEGGGBDJHHFF</span></span>
<span><span class="co">#&gt;   MATE                         PAIR_ID</span></span>
<span><span class="co">#&gt; 1    1 HS25_09827:2:1201:1505:59795#49</span></span>
<span><span class="co">#&gt; 2    1 HS25_09827:2:1201:1559:70726#49</span></span>
<span><span class="co">#&gt; 3    1 HS25_09827:2:1201:1564:39627#49</span></span>
<span><span class="co">#&gt; 4    1 HS25_09827:2:1201:1565:91731#49</span></span>
<span><span class="co">#&gt; 5    1 HS25_09827:2:1201:1624:69925#49</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gff-files">GFF files<a class="anchor" aria-label="anchor" href="#gff-files"></a>
</h3>
<p>These can be open with or with attributes maps</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gff_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"gff_file.gff.gz"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_gff.html">rduckhts_gff</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"genes"</span>, <span class="va">gff_path</span>, attributes_map <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">gene_annotations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT seqname, start, \"end\" FROM genes WHERE feature = 'gene' LIMIT 5"</span><span class="op">)</span></span>
<span><span class="va">gene_annotations</span></span>
<span><span class="co">#&gt;   seqname   start     end</span></span>
<span><span class="co">#&gt; 1       X 2934816 2964270</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bamcram">BAM/CRAM<a class="anchor" aria-label="anchor" href="#bamcram"></a>
</h3>
<p>When built with htslib codec, <code>CRAM</code> can be opened in addition to <code>BAM</code> files</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cram_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"range.cram"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">ref_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ce.fa"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_bam.html">rduckhts_bam</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"cram_reads"</span>, <span class="va">cram_path</span>, reference <span class="op">=</span> <span class="va">ref_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cram_reads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT QNAME, FLAG, POS, MAPQ FROM cram_reads LIMIT 5"</span><span class="op">)</span></span>
<span><span class="va">cram_reads</span></span>
<span><span class="co">#&gt;                           QNAME FLAG  POS MAPQ</span></span>
<span><span class="co">#&gt; 1 HS18_09653:4:1315:19857:61712  145  914   23</span></span>
<span><span class="co">#&gt; 2 HS18_09653:4:1308:11522:27107  161  934    0</span></span>
<span><span class="co">#&gt; 3 HS18_09653:4:2314:14991:85680   83 1020   10</span></span>
<span><span class="co">#&gt; 4 HS18_09653:4:2108:14085:93656  147 1122   60</span></span>
<span><span class="co">#&gt; 5  HS18_09653:4:1303:4347:38100   83 1137   37</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="samtags--auxiliary-tags">SAMtags + auxiliary tags<a class="anchor" aria-label="anchor" href="#samtags--auxiliary-tags"></a>
</h3>
<p>Standard SAMtags can be exposed as typed columns, and any remaining tags are available via <code>AUXILIARY_TAGS</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aux_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"aux_tags.sam.gz"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rduckhts_bam.html">rduckhts_bam</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"aux_reads"</span>, <span class="va">aux_path</span>, standard_tags <span class="op">=</span> <span class="cn">TRUE</span>, auxiliary_tags <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT RG, NM, map_extract(AUXILIARY_TAGS, 'XZ') AS XZ FROM aux_reads LIMIT 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   RG NM  XZ</span></span>
<span><span class="co">#&gt; 1 x1  2 foo</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tabix-headers--types">Tabix headers + types<a class="anchor" aria-label="anchor" href="#tabix-headers--types"></a>
</h3>
<p>Use <code>header = TRUE</code> to use the first non-meta row as column names, and <code>auto_detect = TRUE</code> / <code>column_types</code> to control column typing:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tabix_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"header_tabix.tsv.gz"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span><span class="va">tabix_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"meta_tabix.tsv.gz"</span>, package <span class="op">=</span> <span class="st">"Rduckhts"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/rduckhts_tabix.html">rduckhts_tabix</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"header_tabix"</span>, <span class="va">tabix_header</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT chrom, pos FROM header_tabix LIMIT 2"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   chrom pos</span></span>
<span><span class="co">#&gt; 1  chr1   1</span></span>
<span><span class="co">#&gt; 2  chr1   2</span></span>
<span></span>
<span><span class="fu"><a href="reference/rduckhts_tabix.html">rduckhts_tabix</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"typed_tabix"</span>, <span class="va">tabix_meta</span>, auto_detect <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT typeof(column1) AS column1_type FROM typed_tabix LIMIT 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   column1_type</span></span>
<span><span class="co">#&gt; 1       BIGINT</span></span>
<span></span>
<span><span class="fu"><a href="reference/rduckhts_tabix.html">rduckhts_tabix</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"typed_tabix_explicit"</span>, <span class="va">tabix_header</span>,</span>
<span>               header <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               column_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VARCHAR"</span>, <span class="st">"BIGINT"</span>, <span class="st">"VARCHAR"</span><span class="op">)</span>,</span>
<span>               overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT pos + 1 AS pos_plus_one FROM typed_tabix_explicit LIMIT 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   pos_plus_one</span></span>
<span><span class="co">#&gt; 1            2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remote-gtex-tabix-example">Remote GTEx tabix example<a class="anchor" aria-label="anchor" href="#remote-gtex-tabix-example"></a>
</h3>
<p>GTEx eQTL matrices on EBI are tabix-indexed</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtex_url</span> <span class="op">&lt;-</span> <span class="st">"http://ftp.ebi.ac.uk/pub/databases/spot/eQTL/imported/GTEx_V8/ge/Brain_Cerebellar_Hemisphere.tsv.gz"</span></span>
<span><span class="fu"><a href="reference/rduckhts_tabix.html">rduckhts_tabix</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"gtex_eqtl"</span>, <span class="va">gtex_url</span>, region <span class="op">=</span> <span class="st">"1:11868-14409"</span>,</span>
<span>               header <span class="op">=</span> <span class="cn">TRUE</span>, auto_detect <span class="op">=</span> <span class="cn">TRUE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM gtex_eqtl LIMIT 5"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>DuckDB: <a href="https://duckdb.org/" class="external-link uri">https://duckdb.org/</a>
</li>
<li>DuckDB Extension API: <a href="https://duckdb.org/docs/extensions/overview" class="external-link uri">https://duckdb.org/docs/extensions/overview</a>
</li>
<li>DuckDB extension template (C): <a href="https://github.com/duckdb/extension-template-c" class="external-link uri">https://github.com/duckdb/extension-template-c</a>
</li>
<li>htslib: <a href="https://github.com/samtools/htslib" class="external-link uri">https://github.com/samtools/htslib</a>
</li>
<li>RBCFTools: <a href="https://github.com/RGenomicsETL/RBCFTools" class="external-link uri">https://github.com/RGenomicsETL/RBCFTools</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>GPL-3.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/RGenomicsETL/duckhts/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/RGenomicsETL/duckhts/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Rduckhts</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sounkou Mahamane Toure <br><small class="roles"> Author, maintainer </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sounkou Mahamane Toure.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
